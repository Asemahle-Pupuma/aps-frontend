<!DOCTYPE html>
<html>
<head>
  <title>APS Calculator</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 500px;
      margin: 40px auto;
      padding: 20px;
      background: #f0f2f5;
      border-radius: 12px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    h2 {
      text-align: center;
    }
    input, select, button {
      display: block;
      width: 100%;
      margin: 12px 0;
      padding: 10px;
      font-size: 16px;
    }
    button {
      background: #007bff;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
    button:hover {
      background: #0056b3;
    }
  </style>
</head>
<body>
  <h2>APS Calculator</h2>

  <div id="institutions-list">
    <h3>Public Higher Education Institutions</h3>
    <ul id="institution-ul"></ul>
  </div>

  <div id="faculties-list">
  <h3>Faculties</h3>
  <ul id="faculty-ul"></ul>
</div>

  <div id="subject-inputs"></div>
  <button onclick="calculateAPS()">Calculate & Show Qualified Courses</button>
  <div id="results"></div>

  <script>
    // Subject Selection Setup
    const subjects = [
  "English Home Language", "English First Additional Language", "English Second Additional Language",
  "Afrikaans Home Language", "Afrikaans First Additional Language", "Afrikaans Second Additional Language",
  "IsiZulu Home Language", "IsiZulu First Additional Language",
  "IsiXhosa Home Language", "IsiXhosa First Additional Language",
  "IsiNdebele", "Sepedi", "Sesotho", "Setswana", "SiSwati", "Tshivenda", "Xitsonga",
  "Mathematics", "Mathematical Literacy", "Technical Mathematics",
  "Physical Sciences", "Life Sciences", "Agricultural Sciences", "Computer Applications Technology",
  "Information Technology", "Geography", "History", "Religious Studies",
  "Accounting", "Business Studies", "Economics", "Tourism", "Hospitality Studies", "Consumer Studies",
  "Visual Arts", "Dramatic Arts", "Design", "Dance Studies", "Music",
  "Engineering Graphics and Design", "Mechanical Technology", "Electrical Technology", "Civil Technology",
  "Technical Sciences", "Agricultural Technology", "Agricultural Management Practices",
  "Marine Sciences", "Equine Studies", "Sport and Exercise Science",
  "Life Orientation"
];
    const container = document.getElementById('subject-inputs');
    for (let i = 0; i < 9; i++) {
      const select = document.createElement('select');
      subjects.forEach(sub => {
        const option = document.createElement('option');
        option.value = sub;
        option.text = sub;
        select.appendChild(option);
      });
      const input = document.createElement('input');
      input.type = 'number';
      input.placeholder = 'Mark (%)';
      container.appendChild(select);
      container.appendChild(input);
    }

    // APS Calculation
    async function calculateAPS() {
      const inputs = container.querySelectorAll('input');
      const selects = container.querySelectorAll('select');
      const selections = [];
      for (let i = 0; i < 9; i++) {
        selections.push({ subject: selects[i].value, mark: parseInt(inputs[i].value) });
      }
      const res = await fetch('https://4c87234e-09cc-4cb8-b921-bf7b6d96050b-00-3kaul8eecqlci.riker.replit.dev:5000/calculate', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ subjects: selections })
      });
      const data = await res.json();
      document.getElementById('results').innerHTML = data.error ? data.error : JSON.stringify(data, null, 2);
       ? data.error
    : `Your APS score is: ${data.totalAPS}`;
      <div id="qualified-courses">
  <h3>Qualified Courses</h3>
  <ul id="course-list"></ul>
</div>

  if (!data.error) {
    fetchQualifiedCourses(data.totalAPS, data.qualifiedSubjects);
  }
    }

    // ðŸ”½ Fetch Institutions and Display
    async function fetchInstitutions() {
      try {
        const res = await fetch('https://4c87234e-09cc-4cb8-b921-bf7b6d96050b-00-3kaul8eecqlci.riker.replit.dev/api/institutions');
        const institutions = await res.json();
        const list = document.getElementById('institution-ul');
        institutions.forEach(inst => {
          const li = document.createElement('li');
          li.textContent = `${inst.name} (${inst.code})`;
          li.style.cursor = 'pointer';
          li.onclick = () => fetchFaculties(inst.code);
          list.appendChild(li);
        });
      } catch (error) {
        console.error("Failed to load institutions:", error);
      }
    }
    
  async function fetchFaculties(institutionCode) {
   try {
    const res = await fetch(`https://4c87234e-09cc-4cb8-b921-bf7b6d96050b-00-3kaul8eecqlci.riker.replit.dev/api/faculties?institutionCode=${institutionCode}`);
    const faculties = await res.json();
    const list = document.getElementById('faculty-ul');
    list.innerHTML = ""; // Clear previous list

    faculties.forEach(fac => {
      const li = document.createElement('li');
      li.textContent = fac.faculty_name || fac.name;
      list.appendChild(li);
    });
  } catch (error) {
    console.error("Failed to load faculties:", error);
  }
}
async function fetchQualifiedCourses(aps, subjects) {
  const subjectList = subjects.join(",");
  try {
    const res = await fetch(`https://4c87234e-09cc-4cb8-b921-bf7b6d96050b-00-3kaul8eecqlci.riker.replit.dev/api/courses/filter?aps=${aps}&subjects=${subjectList}`);
    const courses = await res.json();
    const list = document.getElementById("course-list");
    list.innerHTML = "";

    if (courses.length === 0) {
      list.innerHTML = "<li>No qualifying courses found.</li>";
      return;
    }

    courses.forEach(course => {
      const li = document.createElement("li");
      li.textContent = `${course.courseName} (${course.faculty}) - APS: ${course.apsRequired}`;
      list.appendChild(li);
    });
  } catch (error) {
    console.error("Error fetching courses:", error);
  }
}

    // Run this immediately on page load
    fetchInstitutions();
  </script>
</body>
</html>

